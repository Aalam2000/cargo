{% extends '../base.html' %}
{% load static %}

{% block title %}–¢–æ–≤–∞—Ä—ã ‚Äî Products{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/table.css' %}">
<div class="cargo-table-page">
  <div class="table-header-container">
    <h3>üì¶ –¢–æ–≤–∞—Ä—ã</h3>
    <div class="d-flex gap-3">
      <div class="filter-container d-flex gap-2"></div>
      <button id="settings-btn" class="settings-button" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" data-action="settings">‚öôÔ∏è</button>
      {% if user.role in "Admin,Operator" %}
      <button id="add-row" class="btn-table add-button" data-action="add">‚ûï</button>
      {% endif %}
    </div>
  </div>

  <div class="table-container">
    <div class="table-wrapper" data-table-key="product_table" data-table-id="product-table">
      <table id="product-table" class="table">
        <thead><tr id="product-header-row"></tr></thead>
        <tbody id="product-body"></tbody>
      </table>
    </div>
    <div id="loader" class="loader text-center" style="display:none; padding:12px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  {% include 'cargo_acc/settings_modal.html' %}
</div>

<script>
  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–≤–∫–ª—é—á–∞–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ –∏–º—ë–Ω)
  window.PRODUCT_TABLE_META = {
    // –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–º—ë–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏
    tableKey: "product_table",
    table_key: "product_table",
    key: "product_table",

    tableId: "product-table",
    table_id: "product-table",
    tableIdLegacy: "product-table",

    tableName: "product",
    table_name: "product",

    // –≤–µ—Ä–æ—è—Ç–Ω—ã–µ API –ø—É—Ç–∏ ‚Äî –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ
    apiPath: "/cargo_acc/api/products/",
    api_path: "/cargo_acc/api/products/",
    listEndpoint: "/cargo_acc/api/products/",

    rowApiPath: "/cargo_acc/api/product/",
    row_api_path: "/cargo_acc/api/product/",

    configPath: "/cargo_acc/api/get_table_settings/?table_id=product-table",
    config_path: "/api/table_settings/?key=product_table",
    saveSettingsPath: "/cargo_acc/api/save_table_settings/",
    addRowModalPath: "/cargo_acc/mod_addrow",
    delRowModalPath: "/cargo_acc/mod_delrow",
  };

  // –¥—É–±–ª–∏—Ä—É–µ–º –≤ legacy-–∏–º—è (–µ—Å–ª–∏ load_product_table.js —á–∏—Ç–∞–µ—Ç –¥—Ä—É–≥–æ–µ –æ–∫–Ω–æ)
  window.PRODUCT_TABLE_META_LEGACY = window.PRODUCT_TABLE_META;
  window.CARGO_USER_ROLE = "{{ user.role }}";
  window.CLIENT_CODE = "{{ user.client_code|default:'' }}";
</script>

<script defer src="{% static 'js/load_product_table.js' %}"></script>
<script defer src="{% static 'js/product_table_init.js' %}"></script>
{% endblock %}
