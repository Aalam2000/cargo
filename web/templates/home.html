{% extends "base.html" %}
{% load static %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è ‚Äî Cargo ‚Ññ1{% endblock %}
{% block content %}
    <link rel="stylesheet" href="{% static 'css/table.css' %}">
    <script defer src="{% static 'js/home.js' %}"></script>

    <div class="cargo-table-page">
        <div class="table-header-container">
            <h3>–ì–ª–∞–≤–Ω–∞—è</h3>
        </div>
        <meta name="user-role" content="{{ role }}">

        <!-- üîπ –ë–ª–æ–∫ –±–∞–ª–∞–Ω—Å–∞ -->
        <div id="client-balance" class="balance-box hidden">
            <div class="balance-label">üí∞ –û–ø–ª–∞—á–µ–Ω–æ:</div>
            <div id="balance-value" class="balance-value">‚Äî</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="in_transit">üöö –í –ø—É—Ç–∏</button>
            <button class="tab-btn" data-tab="delivered">üì¶ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ</button>
            <button class="tab-btn" data-tab="payments">üí≥ –û–ø–ª–∞—Ç—ã</button>
        </div>

        <!-- ===== –í –ü–£–¢–ò ===== -->
        <div id="tab-in_transit" class="tab-content active">
            <div class="filter-bar">
                {% if role in "Admin Operator" %}
                    <input id="productFilter_in_transit" class="input-filter" placeholder="–ù–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞" type="text">
                    <input id="clientFilter_in_transit" class="input-filter" placeholder="–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞" type="text"
                           oninput="updateClientBalance(this.value)">
                {% elif role == "Client" %}
                    <input id="productFilter_in_transit" class="input-filter" placeholder="–ù–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞" type="text">
                {% endif %}
                <button class="btn-table" onclick="applyTableFilter('in_transit')">–ü–æ–∏—Å–∫</button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–ö–û–î</th>
                        <th>–û–ü–ò–°–ê–ù–ò–ï</th>
                        <th>–°–ö–õ–ê–î</th>
                        <th>–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï</th>
                        <th>–í–ï–°</th>
                        <th>–°–¢–û–ò–ú–û–°–¢–¨</th>
                        <th>–°–¢–ê–¢–£–°</th>
                    </tr>
                    </thead>
                    <tbody id="tbody_in_transit">
                    {% for p in in_transit %}
                        <tr>
                            <td>{{ p.product_code }}</td>
                            <td>{{ p.cargo_description }}</td>
                            <td>{{ p.warehouse.name }}</td>
                            <td>{{ p.destination_place }}</td>
                            <td>{{ p.weight }}</td>
                            <td>{{ p.cost }}</td>
                            <td>{{ p.cargo_status.name }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                        </tr>{% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ===== –î–û–°–¢–ê–í–õ–ï–ù–ù–´–ï ===== -->
        <div id="tab-delivered" class="tab-content">
            <div class="filter-bar">
                {% if role in "Admin Operator" %}
                    <input id="productFilter_delivered" class="input-filter" placeholder="–ù–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞" type="text">
                    <input id="clientFilter_delivered" class="input-filter" placeholder="–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞" type="text"
                           oninput="updateClientBalance(this.value)">
                {% elif role == "Client" %}
                    <input id="productFilter_delivered" class="input-filter" placeholder="–ù–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞" type="text">
                {% endif %}
                <button class="btn-table" onclick="applyTableFilter('delivered')">–ü–æ–∏—Å–∫</button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–ö–û–î</th>
                        <th>–û–ü–ò–°–ê–ù–ò–ï</th>
                        <th>–°–ö–õ–ê–î</th>
                        <th>–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï</th>
                        <th>–í–ï–°</th>
                        <th>–°–¢–û–ò–ú–û–°–¢–¨</th>
                        <th>–î–ê–¢–ê –î–û–°–¢–ê–í–ö–ò</th>
                    </tr>
                    </thead>
                    <tbody id="tbody_delivered">
                    {% for p in delivered %}
                        <tr>
                            <td>{{ p.product_code }}</td>
                            <td>{{ p.cargo_description }}</td>
                            <td>{{ p.warehouse.name }}</td>
                            <td>{{ p.destination_place }}</td>
                            <td>{{ p.weight }}</td>
                            <td>{{ p.cost }}</td>
                            <td>{{ p.delivery_date }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7">–ù–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö</td>
                        </tr>{% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ===== –û–ü–õ–ê–¢–´ ===== -->
        <div id="tab-payments" class="tab-content">
            <div class="filter-bar">
                {% if role in "Admin Operator" %}
                    <input id="clientFilter_payments" class="input-filter" placeholder="–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞" type="text"
                           oninput="updateClientBalance(this.value)">
                    <button class="btn-table" onclick="applyTableFilter('payments')">–ü–æ–∏—Å–∫</button>
                {% endif %}
            </div>

            {% if role in "Admin Operator" %}
            <div class="table-header-container">
              <h3>–û–ø–ª–∞—Ç—ã</h3>
              <button id="btnAddPayment" class="btn-table">+</button>
            </div>
            {% endif %}

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–î–ê–¢–ê</th>
                        <th>–ö–õ–ò–ï–ù–¢</th>
                        <th>–°–£–ú–ú–ê</th>
                        <th>–ú–ï–¢–û–î</th>
                        <th>–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô</th>
                    </tr>
                    </thead>
                    <tbody id="tbody_payments">
                    {% for pay in payments %}
                        <tr>
                            <td>{{ pay.payment_date }}</td>
                            <td>{{ pay.client.client_code }}</td>
                            <td>{{ pay.amount_total }}</td>
                            <td>{{ pay.method }}</td>
                            <td>{{ pay.comment }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5">–ü–ª–∞—Ç–µ–∂–µ–π –Ω–µ—Ç</td>
                        </tr>{% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
