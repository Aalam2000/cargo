{% extends '../base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endblock %}

{% block content %}
<div class="profile-card">
    <form id="profile-form" method="POST" class="profile-form">
        {% csrf_token %}

        <div class="profile-header" style="display:flex;justify-content:space-between;align-items:flex-start;">
            {% if user.role != "Client" %}
                <h1 class="profile-title">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
            {% endif %}

            {% if user.role == "Client" %}
                <h3>–ö–ª–∏–µ–Ω—Ç: {{ request.user.client_code }}</h3>

                <div id="client-type-switch" style="display:flex;flex-direction:column;align-items:flex-end;">
                    <label>
                        <input type="radio"
                               name="client_type"
                               value="individual"
                               required
                               {% if user.client_type == 'individual' or not user.client_type %}checked{% endif %}>
                        –§–∏–∑. –ª–∏—Ü–æ
                    </label>
                    <label>
                        <input type="radio"
                               name="client_type"
                               value="company"
                               required
                               {% if user.client_type == 'company' %}checked{% endif %}>
                        –Æ—Ä. –ª–∏—Ü–æ
                    </label>
                </div>
            {% endif %}
        </div>

        <div class="profile-grid">

            <!-- –û–±—â–∏–µ –ø–æ–ª—è -->
            <div class="form-group">
                    <label for="first_name">–ò–º—è</label>
                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" required>
                </div>

            <div class="form-group">
                <label for="last_name">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" required>
            </div>

            <div class="form-group">
                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="text" id="phone" name="phone" value="{{ user.phone }}">
            </div>

            <div class="form-group">
                <label for="telegram">Telegram</label>
                <input type="text" id="telegram" name="telegram" value="{{ user.telegram }}">
            </div>

            <div class="form-group">
                <label for="whatsapp">WhatsApp</label>
                <input type="text" id="whatsapp" name="whatsapp" value="{{ user.whatsapp }}">
            </div>

            <div class="form-group">
                <label>Email</label>
                <p class="readonly">{{ user.email }}</p>
            </div>

            <div class="form-group">
                <label>–†–æ–ª—å</label>
                <p class="readonly">{{ user.role }}</p>
            </div>

            {% if user.role == "Client" %}
                <hr class="profile-separator">

                <div class="form-group">
                    <label for="inn">–ò–ù–ù</label>
                    <input type="text" id="inn" name="inn" value="{{ user.inn }}">
                </div>

                <!-- –§–∏–∑. –ª–∏—Ü–æ -->
                <div id="block-individual"
                     class="client-block"
                     style="{% if user.client_type != 'individual' %}display:none;{% endif %}">
                    <div class="form-group">
                        <label for="address">–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
                        <input type="text" id="address" name="address" value="{{ user.address }}">
                    </div>
                </div>

                <!-- –Æ—Ä. –ª–∏—Ü–æ -->
                <div id="block-company"
                     class="client-block"
                     style="{% if user.client_type != 'company' %}display:none;{% endif %}">

                    <div class="form-group">
                        <label for="company_name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                        <input type="text" id="company_name" name="company_name" value="{{ user.company_name }}">
                    </div>

                    <div class="form-group">
                        <label for="ogrn">–û–ì–†–ù</label>
                        <input type="text" id="ogrn" name="ogrn" value="{{ user.ogrn }}">
                    </div>

                    <div class="form-group">
                        <label for="legal_address">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                        <input type="text" id="legal_address" name="legal_address" value="{{ user.legal_address }}">
                    </div>

                    <div class="form-group">
                        <label for="actual_address">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                        <input type="text" id="actual_address" name="actual_address" value="{{ user.actual_address }}">
                    </div>

                    <div class="form-group">
                        <label for="representative">–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å (–§–ò–û)</label>
                        <input type="text" id="representative" name="representative" value="{{ user.representative }}">
                    </div>

                    <div class="form-group">
                        <label for="basis">–û—Å–Ω–æ–≤–∞–Ω–∏–µ (–£—Å—Ç–∞–≤ / –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)</label>
                        <input type="text" id="basis" name="basis" value="{{ user.basis }}">
                    </div>

                    <div class="form-group">
                        <label for="bank_name">–ë–∞–Ω–∫</label>
                        <input type="text" id="bank_name" name="bank_name" value="{{ user.bank_name }}">
                    </div>

                    <div class="form-group">
                        <label for="bic">–ë–ò–ö / SWIFT</label>
                        <input type="text" id="bic" name="bic" value="{{ user.bic }}">
                    </div>

                    <div class="form-group">
                        <label for="account">–†–∞—Å—á—ë—Ç–Ω—ã–π —Å—á—ë—Ç</label>
                        <input type="text" id="account" name="account" value="{{ user.account }}">
                    </div>

                    <div class="form-group">
                        <label for="corr_account">–ö–æ—Ä—Ä. —Å—á—ë—Ç</label>
                        <input type="text" id="corr_account" name="corr_account" value="{{ user.corr_account }}">
                    </div>
                </div>
            {% endif %}

            {% if user.role == "Admin" or user.role == "Operator" %}
                <hr class="profile-separator">

                <div class="form-group">
                    <label for="default_warehouse">–°–∫–ª–∞–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                    <select id="default_warehouse" name="default_warehouse">
                        {% for w in warehouses %}
                            <option value="{{ w.id }}"
                                {% if user.default_warehouse and user.default_warehouse.id == w.id %}selected{% endif %}>
                                {{ w.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="default_cargo_type">–¢–∏–ø –≥—Ä—É–∑–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                    <select id="default_cargo_type" name="default_cargo_type">
                        {% for ct in cargo_types %}
                            <option value="{{ ct.id }}"
                                {% if user.default_cargo_type and user.default_cargo_type.id == ct.id %}selected{% endif %}>
                                {{ ct.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="default_cargo_status">–°—Ç–∞—Ç—É—Å –≥—Ä—É–∑–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                    <select id="default_cargo_status" name="default_cargo_status">
                        {% for cs in cargo_statuses %}
                            <option value="{{ cs.id }}"
                                {% if user.default_cargo_status and user.default_cargo_status.id == cs.id %}selected{% endif %}>
                                {{ cs.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="default_packaging_type">–£–ø–∞–∫–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                    <select id="default_packaging_type" name="default_packaging_type">
                        {% for pt in packaging_types %}
                            <option value="{{ pt.id }}"
                                {% if user.default_packaging_type and user.default_packaging_type.id == pt.id %}selected{% endif %}>
                                {{ pt.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="location">–õ–æ–∫–∞—Ü–∏—è</label>
                    <input type="text" id="location" name="location" value="{{ user.location }}">
                </div>

            {% endif %}
        </div>

        <div class="profile-actions">
            <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" id="btn-password" class="btn btn-cancel">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>

            {% if user.role == "Client" %}
                <button type="button" id="btn-contract" class="btn">üìÑ –î–æ–≥–æ–≤–æ—Ä</button>
                <button type="button" id="btn-pay" class="btn">üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ QR</button>
            {% endif %}
        </div>
    </form>

    {% if user.role == "Client" %}
        <div id="contract-status" class="text-center" style="margin-top:15px;">
            {% if user.contract_signed %}
                <span style="color:green;font-weight:600;">‚úÖ –î–æ–≥–æ–≤–æ—Ä –ø–æ–¥–ø–∏—Å–∞–Ω</span>
            {% else %}
                <span style="color:#b00;font-weight:600;">
                    ‚ö†Ô∏è –î–æ–≥–æ–≤–æ—Ä –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω ‚Äî –¥–æ—Å—Ç—É–ø –∫ —Ç–æ–≤–∞—Ä–∞–º –∏ –æ–ø–ª–∞—Ç–∞–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω
                </span>
            {% endif %}
        </div>
    {% endif %}
</div>

<script defer src="{% static 'js/profile.js' %}"></script>
{% endblock %}
